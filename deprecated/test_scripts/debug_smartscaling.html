<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Debug SmartScaling</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #1a1a1a;
      color: #ffffff;
    }
    .container {
      width: 800px;
      height: 400px;
      margin: 20px auto;
      border: 1px solid #3a3a3a;
    }
    .controls {
      width: 800px;
      margin: 0 auto;
      padding: 10px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }
    button {
      padding: 5px 10px;
      background: #3a3a3a;
      color: white;
      border: 1px solid #4a4a4a;
      border-radius: 4px;
      cursor: pointer;
    }
    pre {
      background: #2a2a2a;
      padding: 10px;
      margin: 10px auto;
      width: 800px;
      max-height: 200px;
      overflow: auto;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h2 style="text-align: center;">SmartScaling Debug</h2>
  
  <div class="container" id="chart"></div>
  
  <div class="controls">
    <button id="enable-auto">Enable Auto-Scale</button>
    <button id="disable-auto">Disable Auto-Scale</button>
    <button id="fit-content">Fit Content</button>
    <button id="check-state">Check State</button>
  </div>
  
  <pre id="log"></pre>
  
  <script src="node_modules/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
  <script>
    // Add debug logging
    const log = document.getElementById('log');
    function debugLog(message) {
      const now = new Date().toLocaleTimeString();
      log.innerHTML += `[${now}] ${message}\n`;
      console.log(message);
      log.scrollTop = log.scrollHeight;
    }
    
    // Check if chart methods are available
    const methodsToCheck = [
      'subscribeClick', 
      'subscribeDblClick',
      'subscribeCrosshairMove',
      'timeScale',
      'priceScale',
      'applyOptions'
    ];
    
    // Main chart
    let chart;
    let series;
    
    // Initialize chart
    function initChart() {
      const container = document.getElementById('chart');
      
      debugLog('Creating chart...');
      chart = LightweightCharts.createChart(container, {
        width: container.clientWidth,
        height: container.clientHeight,
        layout: {
          background: { color: '#1a1a1a' },
          textColor: '#d9d9d9',
        },
        grid: {
          vertLines: { color: '#2a2a2a' },
          horzLines: { color: '#2a2a2a' },
        },
        rightPriceScale: {
          autoScale: true,
          scaleMargins: {
            top: 0.2,
            bottom: 0.1,
          },
        },
      });
      
      // Check available methods
      debugLog('Checking chart methods:');
      methodsToCheck.forEach(method => {
        const exists = typeof chart[method] === 'function';
        debugLog(`- ${method}: ${exists ? 'Available ✓' : 'Missing ✗'}`);
      });
      
      // Create series
      debugLog('Creating candlestick series...');
      series = chart.addCandlestickSeries();
      
      // Generate sample data
      const data = generateData();
      series.setData(data);
      
      // Set up controls
      document.getElementById('enable-auto').addEventListener('click', () => {
        debugLog('Enabling auto-scale');
        chart.priceScale('right').applyOptions({ autoScale: true });
      });
      
      document.getElementById('disable-auto').addEventListener('click', () => {
        debugLog('Disabling auto-scale');
        chart.priceScale('right').applyOptions({ autoScale: false });
      });
      
      document.getElementById('fit-content').addEventListener('click', () => {
        debugLog('Fitting content');
        chart.timeScale().fitContent();
      });
      
      document.getElementById('check-state').addEventListener('click', () => {
        const isAutoScale = chart.priceScale('right').options().autoScale;
        debugLog(`Current auto-scale state: ${isAutoScale ? 'Enabled' : 'Disabled'}`);
      });
    }
    
    // Generate sample data
    function generateData() {
      const data = [];
      const startTime = new Date(Date.UTC(2025, 4, 1, 0, 0, 0));
      let price = 1.0850;
      
      debugLog('Generating sample data...');
      
      for (let i = 0; i < 100; i++) {
        const time = new Date(startTime);
        time.setUTCDate(time.getUTCDate() + Math.floor(i / 24));
        time.setUTCHours(i % 24);
        
        const volatility = 0.0005 + (Math.random() * 0.001);
        const trend = (Math.random() > 0.5 ? 1 : -1) * 0.0002;
        
        price += trend;
        
        const open = price;
        const high = price + (Math.random() * volatility);
        const low = price - (Math.random() * volatility);
        const close = price + (Math.random() * volatility * 2 - volatility);
        
        price = close;
        
        data.push({
          time: Math.floor(time.getTime() / 1000),
          open: open,
          high: high,
          low: low,
          close: close
        });
      }
      
      debugLog(`Generated ${data.length} candles`);
      return data;
    }
    
    // Initialize when document is ready
    document.addEventListener('DOMContentLoaded', initChart);
  </script>
</body>
</html>